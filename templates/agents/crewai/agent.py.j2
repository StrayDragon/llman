"""Generated by llman agents gen-code.

Agent preset: {{ agent_id }}
"""

from __future__ import annotations

import os
import sys


# --- Preset Manifest (expanded) ---
# Agent: {{ agent_id }}
# Includes:
{% for skill_id in includes %}
# - {{ skill_id }}
{% endfor %}
{% if skills_meta and skills_meta | length > 0 %}
# Skills meta:
{% for s in skills_meta %}
# - id={{ s.id }}{% if s.path %} path={{ s.path }}{% endif %}
{% endfor %}
{% endif %}


def _require_env(name: str) -> str:
    value = os.getenv(name)
    if not value:
        print(f"Error: environment variable {name} is required", file=sys.stderr)
        raise SystemExit(2)
    return value


OPENAI_API_KEY = _require_env("OPENAI_API_KEY")


def _require_env_fallback(primary: str, fallback: str) -> str:
    value = os.getenv(primary) or os.getenv(fallback)
    if not value:
        print(
            f"Error: environment variable {primary} is required (or set {fallback})",
            file=sys.stderr,
        )
        raise SystemExit(2)
    return value


OPENAI_MODEL = _require_env_fallback("OPENAI_MODEL", "OPENAI_DEFAULT_MODEL")
OPENAI_BASE_URL = (
    os.getenv("OPENAI_BASE_URL") or os.getenv("OPENAI_API_BASE") or "https://api.openai.com/v1"
)

SYSTEM_PROMPT = {{ system_prompt_json }}


def main() -> None:
    try:
        from crewai import Agent as CrewAgent, Task, Crew
        from crewai.llm import LLM
    except Exception:
        print("Error: missing dependency. Install: pip install crewai", file=sys.stderr)
        raise

    llm = LLM(
        model=OPENAI_MODEL,
        api_key=OPENAI_API_KEY,
        base_url=OPENAI_BASE_URL,
    )

    agent = CrewAgent(
        role="{{ agent_id }}",
        goal="Run the preset system prompt",
        backstory=SYSTEM_PROMPT,
        llm=llm,
        verbose=True,
    )

    msg = os.getenv("AGENT_INPUT") or "Hello"
    task = Task(description=msg, agent=agent, expected_output="A helpful response")
    crew = Crew(agents=[agent], tasks=[task], verbose=True)
    result = crew.kickoff()
    print(result)


if __name__ == "__main__":
    main()
